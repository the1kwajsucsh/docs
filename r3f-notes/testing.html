<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="googlebot" content="follow, index, noarchive"/><meta name="robots" content="follow, index, noarchive"/><meta name="viewport" content="initial-scale=1,width=device-width"/><link rel="apple-touch-icon" href="/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="manifest" href="/site.webmanifest"/><meta name="apple-mobile-web-app-capable" content="yes"/><meta name="apple-mobile-web-app-status-bar-style" content="#000000"/><meta name="apple-mobile-web-app-title" content="PMNDRS"/><meta name="application-name" content="PMNDRS"/><meta name="mobile-web-app-capable" content="yes"/><meta name="msapplication-config" content="/browserconfig.xml"/><meta name="msapplication-navbutton-color" content="#000000"/><meta name="msapplication-starturl" content="https://pmnd.rs/"/><meta name="msapplication-tilecolor" content="#000000"/><meta name="msapplication-tileimage" content="/mstile-144x144.png"/><meta name="msapplication-tooltip" content="PMNDRS"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:creator" content="@pmndrs"/><meta name="twitter:site" content="@pmndrs"/><meta property="og:locale" content="en_us"/><meta property="og:type" content="website"/><link rel="preload" href="/fonts/inter-regular.woff2" as="font" crossorigin=""/><link rel="preload" href="/fonts/inter-medium.woff2" as="font" crossorigin=""/><link rel="preload" href="/fonts/inter-semibold.woff2" as="font" crossorigin=""/><link rel="preload" href="/fonts/inter-bold.woff2" as="font" crossorigin=""/><link rel="preload" href="/fonts/meslo.woff2" as="font" crossorigin=""/><title>React Three Fiber Notes Documentation</title><meta property="og:site_name" content="React Three Fiber Notes Documentation"/><meta name="description" content="Notes and Techniques in R3F"/><meta property="og:type" content="website"/><meta property="og:url" content="https://docs.pmnd.rs/r3f-notes"/><meta property="og:title" content="React Three Fiber Notes Documentation"/><meta property="og:description" content="Notes and Techniques in R3F"/><meta property="og:image"/><meta property="twitter:card" content="summary_large_image"/><meta property="twitter:url" content="https://docs.pmnd.rs/r3f-notes"/><meta property="twitter:title" content="React Three Fiber Notes Documentation"/><meta property="twitter:description" content="Notes and Techniques in R3F"/><meta property="twitter:image"/><meta name="next-head-count" content="42"/><link rel="preload" href="/docs/_next/static/css/e92a5c7795803597.css" as="style"/><link rel="stylesheet" href="/docs/_next/static/css/e92a5c7795803597.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/docs/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/docs/_next/static/chunks/webpack-e0bc744e796cf5a2.js" defer=""></script><script src="/docs/_next/static/chunks/framework-10999fb3c869719f.js" defer=""></script><script src="/docs/_next/static/chunks/main-a69891a0d9f06437.js" defer=""></script><script src="/docs/_next/static/chunks/pages/_app-1699954af7b1195a.js" defer=""></script><script src="/docs/_next/static/chunks/456-7aa896f9fd3abd45.js" defer=""></script><script src="/docs/_next/static/chunks/415-7113f627cdc450a2.js" defer=""></script><script src="/docs/_next/static/chunks/pages/%5B...slug%5D-64ca4405aca8e76a.js" defer=""></script><script src="/docs/_next/static/p0U-IbqHePFZ_BQy1u2Ej/_buildManifest.js" defer=""></script><script src="/docs/_next/static/p0U-IbqHePFZ_BQy1u2Ej/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div id="modal"></div><div class="sticky top-0 flex flex-none w-full mx-auto border-b border-gray-200 bg-white max-w-8xl z-40 lg:z-50"><a aria-label="KWG Docs" href="/"><div class="h-full flex items-center flex-none p-2 pl-4 sm:pl-6 xl:pl-8 lg:w-60 xl:w-72"><span class="font-bold">KWG</span>Â <span class="font-normal">docs</span></div></a><div class="relative w-full"><div class="flex items-center justify-between flex-auto h-16 px-4"><button type="button" class="group leading-6 font-medium flex items-center space-x-3 sm:space-x-4 text-gray-400 hover:text-gray-600 transition-colors duration-200 w-full py-2"><svg width="24" height="24" fill="none" class="text-gray-400 group-hover:text-gray-500 transition-colors duration-200"><path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path></svg><span>Quick search<span class="hidden sm:inline"> for anything</span></span><span style="opacity:1" class="hidden sm:block text-gray-400 text-sm leading-5 py-0.5 px-1.5 border border-gray-300 rounded-md"><span class="sr-only">Press </span><kbd class="font-sans"><abbr title="Forward slash" class="no-underline">/</abbr></kbd><span class="sr-only"> to search</span></span></button></div></div><button class="block lg:hidden p-2 mr-2 ml-2"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button></div><div class="w-full mx-auto max-w-8xl"><div class="lg:flex"><div id="sidebar" class="fixed inset-0 z-40 flex-none w-full h-full bg-black bg-opacity-25 lg:bg-white lg:static lg:h-auto lg:overflow-y-visible lg:pt-0 lg:w-60 xl:w-72 lg:block hidden"><div id="nav-wrapper" class="overflow-hidden overflow-y-auto h-full mr-24 scrolling-touch bg-white lg:h-auto lg:block lg:sticky lg:bg-transparent lg:top-16 lg:mr-0 z-10 relative" style="left:-200px"><nav id="nav" class="overflow-y-auto px-4 font-medium text-base lg:text-sm pb-10 lg:pb-14 sticky?lg:h-(screen-16) z-10 relative"><div class="mt-8 md:mt-0 mb-4"><div class="relative mt-4"><button class="block w-full px-6 py-2 focus:outline-none bg-black rounded-md font-bold text-lg text-white" id="headlessui-popover-button-:R5f6:" type="button" aria-expanded="false">React Three Fiber Notes</button></div></div><ul></ul></nav></div><button class="w-screen h-screen z-0 fixed top-0 right-0 bg-gray-900 hidden" style="opacity:0.4"></button></div><div id="content-wrapper" class="flex-auto "><div class="flex w-full"><div class="flex-auto min-w-0 px-4 pt-8 pb-24 sm:px-6 xl:px-8 lg:pb-16"><div class=""><main class="max-w-3xl mx-auto"><div class="pb-6 mb-4 border-b post-header"><h1 class="mb-4 text-5xl font-bold tracking-tighter">Testing</h1><p class="text-base leading-4 text-gray-400 leading-5">How to test your new store</p></div><main class="content-container"><a href="#resetting-state-between-tests" class="heading text-3xl mb-6 mt-8 tracking-light"><h2 id="resetting-state-between-tests">Resetting state between tests</h2></a>
<p class="mb-4 text-base text-gray-700">When running tests, the stores are not automatically reset before each test run.</p>
<p class="mb-4 text-base text-gray-700">Thus, there can be cases where the state of one test can affect another. To make sure all tests run with a pristine store state, you can mock <code>zustand</code> during testing and replace it with the following code:</p>
<pre class="language-jsx"><code class="language-jsx"><span class="token keyword module">import</span> <span class="token imports">actualCreate</span> <span class="token keyword module">from</span> <span class="token string">&#x27;zustand&#x27;</span>
<span class="token keyword module">import</span> <span class="token imports"><span class="token punctuation">{</span> act <span class="token punctuation">}</span></span> <span class="token keyword module">from</span> <span class="token string">&#x27;react-dom/test-utils&#x27;</span>

<span class="token comment">// a variable to hold reset functions for all stores declared in the app</span>
<span class="token keyword">const</span> storeResetFns <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Set</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// when creating a store, we get its initial state, create a reset function and add it in the set</span>
<span class="token keyword">const</span> <span class="token function-variable function">create</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">createState</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">actualCreate</span><span class="token punctuation">(</span>createState<span class="token punctuation">)</span>
  <span class="token keyword">const</span> initialState <span class="token operator">=</span> store<span class="token punctuation">.</span><span class="token method function property-access">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  storeResetFns<span class="token punctuation">.</span><span class="token method function property-access">add</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> store<span class="token punctuation">.</span><span class="token method function property-access">setState</span><span class="token punctuation">(</span>initialState<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword control-flow">return</span> store
<span class="token punctuation">}</span>

<span class="token comment">// Reset all stores after each test run</span>
<span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">act</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> storeResetFns<span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resetFn</span><span class="token punctuation">)</span> <span class="token arrow operator">=&gt;</span> <span class="token function">resetFn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token keyword module">export</span> <span class="token keyword module">default</span> create
</code></pre>
<p class="mb-4 text-base text-gray-700">The way you can mock a dependency depends on your test runner.</p>
<p class="mb-4 text-base text-gray-700">In <a href="https://jestjs.io/" target="_blank" rel="noopener noreferrer">jest</a>, you can create a <code>__mocks__/zustand.js</code> and place the code there. If your app is using <code>zustand/vanilla</code> instead of <code>zustand</code>, then you&#x27;ll have to place the above code in <code>__mocks__/zustand/vanilla.js</code></p></main></main></div></div><div class="flex-none hidden w-64 pl-8 mr-8 xl:text-sm xl:block"><div class="flex flex-col justify-between overflow-y-auto sticky max-h-(screen-16) pb-6 top-16"><h5 class="text-gray-900 uppercase tracking-wide font-semibold mt-12 mb-2 text-sm lg:text-xs">On This Page</h5><h4><a aria-label="Resetting state between tests" aria-current="true" class="block py-1 text-sm font-normal leading-6 text-gray-500 hover:underline text-gray-900" href="#resetting-state-between-tests">Resetting state between tests</a></h4></div></div></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"docs":[{"slug":["r3f-notes","introduction"],"url":"/r3f-notes/introduction","editURL":"https://github.com/the1kwajsucsh/docs/tree/main/docs/r3f-notes/introduction.mdx","title":"Introduction","description":"Notes and Techniques in R3F","nav":0,"content":"\n### COPY OF ZUSTAND DOCS FOR NOW... Need to start documenting and overwriting this stuff!\n\nA small, fast and scalable bearbones state-management solution. Has a comfy api based on hooks, isn't\nboilerplatey or opinionated, but still just enough to be explicit and flux-like.\n\nDon't disregard it because it's cute. It has quite the claws, lots of time was spent to deal with common pitfalls, like the dreaded [zombie child problem](https://react-redux.js.org/api/hooks#stale-props-and-zombie-children), [react concurrency](https://github.com/bvaughn/rfcs/blob/useMutableSource/text/0000-use-mutable-source.md), and [context loss](https://github.com/facebook/react/issues/13332) between mixed renderers. It may be the one state-manager in the React space that gets all of these right.\n\nYou can try a live demo [here](https://codesandbox.io/s/dazzling-moon-itop4).\n\n```bash\nnpm install zustand\n```\n\n### First create a store\n\nYour store is a hook! You can put anything in it: primitives, objects, functions. The `set` function _merges_ state.\n\n```jsx\nimport create from 'zustand'\n\nconst useStore = create((set) =\u003e ({\n  bears: 0,\n  increasePopulation: () =\u003e set((state) =\u003e ({ bears: state.bears + 1 })),\n  removeAllBears: () =\u003e set({ bears: 0 }),\n}))\n```\n\n### Then bind your components, and that's it!\n\nUse the hook anywhere, no providers needed. Select your state and the component will re-render on changes.\n\n```jsx\nfunction BearCounter() {\n  const bears = useStore((state) =\u003e state.bears)\n  return \u003ch1\u003e{bears} around here ...\u003c/h1\u003e\n}\n\nfunction Controls() {\n  const increasePopulation = useStore((state) =\u003e state.increasePopulation)\n  return \u003cbutton onClick={increasePopulation}\u003eone up\u003c/button\u003e\n}\n```\n\n#### Why zustand over react-redux?\n\n- Simple and un-opinionated\n- Makes hooks the primary means of consuming state\n- Doesn't wrap your app in context providers\n- [Can inform components transiently (without causing render)](recipes#transient-updates-for-often-occurring-state-changes)\n\n---\n"},{"slug":["r3f-notes","recipes"],"url":"/r3f-notes/recipes","editURL":"https://github.com/the1kwajsucsh/docs/tree/main/docs/r3f-notes/recipes.mdx","title":"Recipes","description":"How to do all you need with Zustand","nav":1,"content":"\n## Fetching everything\n\nYou can, but bear in mind that it will cause the component to update on every state change!\n\n```jsx\nconst state = useStore()\n```\n\n## Selecting multiple state slices\n\nIt detects changes with strict-equality (old === new) by default, this is efficient for atomic state picks.\n\n```jsx\nconst nuts = useStore((state) =\u003e state.nuts)\nconst honey = useStore((state) =\u003e state.honey)\n```\n\nFor more control over re-rendering, you may provide an alternative equality function on the second argument.\n\n```jsx\nconst treats = useStore(\n  (state) =\u003e state.treats,\n  (oldTreats, newTreats) =\u003e compare(oldTreats, newTreats)\n)\n```\n\nFor instance, if you want to construct a single object with multiple state-picks inside, similar to redux's mapStateToProps, you can tell zustand that you want the object to be diffed shallowly by passing the `shallow` equality function.\n\n```jsx\nimport shallow from 'zustand/shallow'\n\n// Object pick, re-renders the component when either state.nuts or state.honey change\nconst { nuts, honey } = useStore((state) =\u003e ({ nuts: state.nuts, honey: state.honey }), shallow)\n\n// Array pick, re-renders the component when either state.nuts or state.honey change\nconst [nuts, honey] = useStore((state) =\u003e [state.nuts, state.honey], shallow)\n\n// Mapped picks, re-renders the component when state.treats changes in order, count or keys\nconst treats = useStore((state) =\u003e Object.keys(state.treats), shallow)\n```\n\n## Fetching from multiple stores\n\nSince you can create as many stores as you like, forwarding results to succeeding selectors is as natural as it gets.\n\n```jsx\nconst currentBear = useCredentialsStore((state) =\u003e state.currentBear)\nconst bear = useBearStore((state) =\u003e state.bears[currentBear])\n```\n\n## Memoizing selectors\n\nIt is generally recommended to memoize selectors with useCallback. This will prevent unnecessary computations each render. It also allows React to optimize performance in concurrent mode.\n\n```jsx\nconst fruit = useStore(useCallback((state) =\u003e state.fruits[id], [id]))\n```\n\nIf a selector doesn't depend on scope, you can define it outside the render function to obtain a fixed reference without useCallback.\n\n```jsx\nconst selector = state =\u003e state.berries\n\nfunction Component() {\n  const berries = useStore(selector)\n```\n\n## Overwriting state\n\nThe `set` function has a second argument, `false` by default. Instead of merging, it will replace the state model. Be careful not to wipe out parts you rely on, like actions.\n\n```jsx\nimport omit from 'lodash-es/omit'\n\nconst useStore = create((set) =\u003e ({\n  salmon: 1,\n  tuna: 2,\n  deleteEverything: () =\u003e set({}, true), // clears the entire store, actions included\n  deleteTuna: () =\u003e set((state) =\u003e omit(state, ['tuna']), true),\n}))\n```\n\n## Async actions\n\nJust call `set` when you're ready, zustand doesn't care if your actions are async or not.\n\n```jsx\nconst useStore = create((set) =\u003e ({\n  fishies: {},\n  fetch: async (pond) =\u003e {\n    const response = await fetch(pond)\n    set({ fishies: await response.json() })\n  },\n}))\n```\n\n## Read from state in actions\n\n`set` allows fn-updates `set(state =\u003e result)`, but you still have access to state outside of it through `get`.\n\n```jsx\nconst useStore = create((set, get) =\u003e ({\n  sound: \"grunt\",\n  action: () =\u003e {\n    const sound = get().sound\n    // ...\n  }\n})\n```\n\n## Reading/writing state and reacting to changes outside of components\n\nSometimes you need to access state in a non-reactive way, or act upon the store. For these cases the resulting hook has utility functions attached to its prototype.\n\n```jsx\nconst useStore = create(() =\u003e ({ paw: true, snout: true, fur: true }))\n\n// Getting non-reactive fresh state\nconst paw = useStore.getState().paw\n// Listening to all changes, fires on every change\nconst unsub1 = useStore.subscribe(console.log)\n// Listening to selected changes, in this case when \"paw\" changes\nconst unsub2 = useStore.subscribe(console.log, state =\u003e state.paw)\n// Subscribe also supports an optional equality function\nconst unsub3 = useStore.subscribe(console.log, state =\u003e [state.paw, state.fur], shallow)\n// Subscribe also exposes the previous value\nconst unsub4 = useStore.subscribe((paw, previousPaw) =\u003e console.log(paw, previousPaw), state =\u003e state.paw)\n// Updating state, will trigger listeners\nuseStore.setState({ paw: false })\n// Unsubscribe listeners\nunsub1()\nunsub2()\nunsub3()\nunsub4()\n// Destroying the store (removing all listeners)\nuseStore.destroy()\n\n// You can of course use the hook as you always would\nfunction Component() {\n  const paw = useStore(state =\u003e state.paw)\n```\n\n## Using zustand without React\n\nZustands core can be imported and used without the React dependency. The only difference is that the create function does not return a hook, but the api utilities.\n\n```jsx\nimport create from 'zustand/vanilla'\n\nconst store = create(() =\u003e ({ ... }))\nconst { getState, setState, subscribe, destroy } = store\n```\n\nYou can even consume an existing vanilla store with React:\n\n```jsx\nimport create from 'zustand'\nimport vanillaStore from './vanillaStore'\n\nconst useStore = create(vanillaStore)\n```\n\n## Transient updates (for often occurring state-changes)\n\nThe subscribe function allows components to bind to a state-portion without forcing re-render on changes. Best combine it with useEffect for automatic unsubscribe on unmount. This can make a [drastic](https://codesandbox.io/s/peaceful-johnson-txtws) performance impact when you are allowed to mutate the view directly.\n\n```jsx\nconst useStore = create(set =\u003e ({ scratches: 0, ... }))\n\nfunction Component() {\n  // Fetch initial state\n  const scratchRef = useRef(useStore.getState().scratches)\n  // Connect to the store on mount, disconnect on unmount, catch state-changes in a reference\n  useEffect(() =\u003e useStore.subscribe(\n    scratches =\u003e (scratchRef.current = scratches),\n    state =\u003e state.scratches\n  ), [])\n```\n\n## Sick of reducers and changing nested state? Use Immer!\n\nReducing nested structures is tiresome. Have you tried [immer](https://github.com/mweststrate/immer)?\n\n```jsx\nimport produce from 'immer'\n\nconst useStore = create((set) =\u003e ({\n  lush: { forest: { contains: { a: 'bear' } } },\n  set: (fn) =\u003e set(produce(fn)),\n}))\n\nconst set = useStore((state) =\u003e state.set)\nset((state) =\u003e {\n  state.lush.forest.contains = null\n})\n```\n\n## Middleware\n\nYou can functionally compose your store any way you like.\n\n```jsx\n// Log every time state is changed\nconst log = (config) =\u003e (set, get, api) =\u003e\n  config(\n    (args) =\u003e {\n      console.log('  applying', args)\n      set(args)\n      console.log('  new state', get())\n    },\n    get,\n    api\n  )\n\n// Turn the set method into an immer proxy\nconst immer = (config) =\u003e (set, get, api) =\u003e config((fn) =\u003e set(produce(fn)), get, api)\n\nconst useStore = create(\n  log(\n    immer((set) =\u003e ({\n      bees: false,\n      setBees: (input) =\u003e set((state) =\u003e void (state.bees = input)),\n    }))\n  )\n)\n```\n\n\u003cdetails\u003e\n\u003csummary\u003eHow to pipe middlewares\u003c/summary\u003e\n\n```js\nimport create from 'zustand'\nimport produce from 'immer'\nimport pipe from 'ramda/es/pipe'\n\n/* log and immer functions from previous example */\n/* you can pipe as many middlewares as you want */\nconst createStore = pipe(log, immer, create)\n\nconst useStore = createStore((set) =\u003e ({\n  bears: 1,\n  increasePopulation: () =\u003e set((state) =\u003e ({ bears: state.bears + 1 })),\n}))\n\nexport default useStore\n```\n\nFor a TS example see the following [discussion](https://github.com/pmndrs/zustand/discussions/224#discussioncomment-118208)\n\n\u003c/details\u003e\n\n\u003cdetails\u003e\n\u003csummary\u003eHow to type immer middleware in TypeScript\u003c/summary\u003e\n\n```ts\nimport { State, StateCreator } from 'zustand'\nimport produce, { Draft } from 'immer'\n\n// Immer V8 or lower\nconst immer =\n  \u003cT extends State\u003e(\n    config: StateCreator\u003cT, (fn: (draft: Draft\u003cT\u003e) =\u003e void) =\u003e void\u003e\n  ): StateCreator\u003cT\u003e =\u003e\n  (set, get, api) =\u003e\n    config((fn) =\u003e set(produce(fn) as (state: T) =\u003e T), get, api)\n\n// Immer V9\nconst immer =\n  \u003cT extends State\u003e(\n    config: StateCreator\u003cT, (fn: (draft: Draft\u003cT\u003e) =\u003e void) =\u003e void\u003e\n  ): StateCreator\u003cT\u003e =\u003e\n  (set, get, api) =\u003e\n    config((fn) =\u003e set(produce\u003cT\u003e(fn)), get, api)\n```\n\n\u003c/details\u003e\n\n## Persist middleware\n\nYou can persist your store's data using any kind of storage.\n\n```jsx\nimport create from 'zustand'\nimport { persist } from 'zustand/middleware'\n\nexport const useStore = create(\n  persist(\n    (set, get) =\u003e ({\n      fishes: 0,\n      addAFish: () =\u003e set({ fish: get().fish + 1 }),\n    }),\n    {\n      name: 'food-storage', // unique name\n      getStorage: () =\u003e sessionStorage, // (optional) by default the 'localStorage' is used\n    }\n  )\n)\n```\n\n## Can't live without redux-like reducers and action types?\n\n```jsx\nconst types = { increase: 'INCREASE', decrease: 'DECREASE' }\n\nconst reducer = (state, { type, by = 1 }) =\u003e {\n  switch (type) {\n    case types.increase:\n      return { grumpiness: state.grumpiness + by }\n    case types.decrease:\n      return { grumpiness: state.grumpiness - by }\n  }\n}\n\nconst useStore = create((set) =\u003e ({\n  grumpiness: 0,\n  dispatch: (args) =\u003e set((state) =\u003e reducer(state, args)),\n}))\n\nconst dispatch = useStore((state) =\u003e state.dispatch)\ndispatch({ type: types.increase, by: 2 })\n```\n\nOr, just use our redux-middleware. It wires up your main-reducer, sets initial state, and adds a dispatch function to the state itself and the vanilla api. Try [this](https://codesandbox.io/s/amazing-kepler-swxol) example.\n\n```jsx\nimport { redux } from 'zustand/middleware'\n\nconst useStore = create(redux(reducer, initialState))\n```\n\n## Calling actions outside a React event handler\n\nBecause React handles `setState` synchronously if it's called outside an event handler. Updating the state outside an event handler will force react to update the components synchronously, therefore adding the risk of encountering the zombie-child effect.\nIn order to fix this, the action needs to be wrapped in `unstable_batchedUpdates`\n\n```jsx\nimport { unstable_batchedUpdates } from 'react-dom' // or 'react-native'\n\nconst useStore = create((set) =\u003e ({\n  fishes: 0,\n  increaseFishes: () =\u003e set((prev) =\u003e ({ fishes: prev.fishes + 1 })),\n}))\n\nconst nonReactCallback = () =\u003e {\n  unstable_batchedUpdates(() =\u003e {\n    useStore.getState().increaseFishes()\n  })\n}\n```\n\nMore details: https://github.com/pmndrs/zustand/issues/302\n\n## Redux devtools\n\n```jsx\nimport { devtools } from 'zustand/middleware'\n\n// Usage with a plain action store, it will log actions as \"setState\"\nconst useStore = create(devtools(store))\n// Usage with a redux store, it will log full action types\nconst useStore = create(devtools(redux(reducer, initialState)))\n```\n\ndevtools takes the store function as its first argument, optionally you can name the store with a second argument: `devtools(store, \"MyStore\")`, which will be prefixed to your actions.\ndevtools will only log actions from each separated store unlike in a typical _combined reducers_ redux store. See an approach to combining stores https://github.com/pmndrs/zustand/issues/163\n\n## TypeScript\n\n```tsx\ntype State = {\n  bears: number\n  increase: (by: number) =\u003e void\n}\n\nconst useStore = create\u003cState\u003e((set) =\u003e ({\n  bears: 0,\n  increase: (by) =\u003e set((state) =\u003e ({ bears: state.bears + by })),\n}))\n```\n\nYou can also use an `interface`:\n\n```tsx\nimport { State } from 'zustand'\n\ninterface BearState extends State {\n  bears: number\n  increase: (by: number) =\u003e void\n}\n```\n\nOr, use `combine` and let tsc infer types.\n\n```tsx\nimport { combine } from 'zustand/middleware'\n\nconst useStore = create(\n  combine({ bears: 0 }, (set) =\u003e ({\n    increase: (by: number) =\u003e set((state) =\u003e ({ bears: state.bears + by })),\n  }))\n)\n```\n"},{"slug":["r3f-notes","testing"],"url":"/r3f-notes/testing","editURL":"https://github.com/the1kwajsucsh/docs/tree/main/docs/r3f-notes/testing.mdx","title":"Testing","description":"How to test your new store","nav":2,"content":"\n## Resetting state between tests\n\nWhen running tests, the stores are not automatically reset before each test run.\n\nThus, there can be cases where the state of one test can affect another. To make sure all tests run with a pristine store state, you can mock `zustand` during testing and replace it with the following code:\n\n```jsx\nimport actualCreate from 'zustand'\nimport { act } from 'react-dom/test-utils'\n\n// a variable to hold reset functions for all stores declared in the app\nconst storeResetFns = new Set()\n\n// when creating a store, we get its initial state, create a reset function and add it in the set\nconst create = (createState) =\u003e {\n  const store = actualCreate(createState)\n  const initialState = store.getState()\n  storeResetFns.add(() =\u003e store.setState(initialState, true))\n  return store\n}\n\n// Reset all stores after each test run\nafterEach(() =\u003e {\n  act(() =\u003e storeResetFns.forEach((resetFn) =\u003e resetFn()))\n})\n\nexport default create\n```\n\nThe way you can mock a dependency depends on your test runner.\n\nIn [jest](https://jestjs.io/), you can create a `__mocks__/zustand.js` and place the code there. If your app is using `zustand/vanilla` instead of `zustand`, then you'll have to place the above code in `__mocks__/zustand/vanilla.js`\n"},{"slug":["r3f-notes","libraries"],"url":"/r3f-notes/libraries","editURL":"https://github.com/the1kwajsucsh/docs/tree/main/docs/r3f-notes/libraries.mdx","title":"3rd Party Libraries","description":"","nav":3,"content":"\nZustand provides bear necessities for state management which is great for most projects; however, some users wish to extend the library's feature set. This can be done using 3rd-party libraries created by the community.\n\n\u003e Disclaimer: These libraries may have bugs, limited maintenance, or other limitations and are not officially recommended by pmndrs or the zustand maintainers. This list is to provide a good starting point for someone looking to extend zustand's feature set.\n\n- [zustand-persist](https://github.com/roadmanfong/zustand-persist) - Persist and rehydrate state\n- [simple-zustand-devtools](https://github.com/beerose/simple-zustand-devtools) - Inspect your zustand store in React DevTools ð»âï¸\n- [zustand-store-addons](https://github.com/Diablow/zustand-store-addons) - React state management addons for zustand.\n- [zustand-yjs](https://github.com/tandem-pt/zustand-yjs) - Zustand stores for Yjs structures.\n- [zustand-forms](https://github.com/Conduct/zustand-forms) - fast typesafe form states as zustand stores\n- [zusteller](https://github.com/timkindberg/zusteller) - Your global state savior. \"Just hooks\" + zustand.\n- [geschichte](https://github.com/BowlingX/geschichte) - zustand and immer based hook to manage query parameters\n- [zoov](https://github.com/InfiniteXyy/zoov) - Use ð» Zustand with Module-like api\n- [mobz](https://github.com/2A5F/Mobz) - zustand style mobx api\n- [zustand-saga](https://github.com/Nowsta/zustand-saga) - Zustand middleware for redux-saga (minus redux)\n- [zundo](https://github.com/charkour/zundo) - ð enable time-travel in your apps. undo/redo middleware for zustand\n- [zustand-middleware-computed-state](https://github.com/cmlarsen/zustand-middleware-computed-state) - This is a dead simple middleware for adding computed state to state management library Zustand.\n- [shared-zustand](https://github.com/Tom-Julux/shared-zustand) - cross-tab state sharing for zustand\n"}],"toc":[{"id":"resetting-state-between-tests","level":2,"title":"Resetting state between tests","parent":null}],"title":"Testing","description":"How to test your new store","source":{"compiledSource":"/*@jsxRuntime automatic @jsxImportSource react*/\nconst {Fragment: _Fragment, jsx: _jsx, jsxs: _jsxs} = arguments[0];\nconst {useMDXComponents: _provideComponents} = arguments[0];\nfunction _createMdxContent(props) {\n  const _components = Object.assign({\n    h2: \"h2\",\n    p: \"p\",\n    code: \"code\",\n    pre: \"pre\",\n    span: \"span\",\n    a: \"a\"\n  }, _provideComponents(), props.components);\n  return _jsxs(_Fragment, {\n    children: [_jsx(_components.h2, {\n      id: \"resetting-state-between-tests\",\n      children: \"Resetting state between tests\"\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"When running tests, the stores are not automatically reset before each test run.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"Thus, there can be cases where the state of one test can affect another. To make sure all tests run with a pristine store state, you can mock \", _jsx(_components.code, {\n        children: \"zustand\"\n      }), \" during testing and replace it with the following code:\"]\n    }), \"\\n\", _jsx(_components.pre, {\n      className: \"language-jsx\",\n      children: _jsxs(_components.code, {\n        className: \"language-jsx\",\n        children: [_jsx(_components.span, {\n          className: \"token keyword module\",\n          children: \"import\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token imports\",\n          children: \"actualCreate\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token keyword module\",\n          children: \"from\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token string\",\n          children: \"'zustand'\"\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"token keyword module\",\n          children: \"import\"\n        }), \" \", _jsxs(_components.span, {\n          className: \"token imports\",\n          children: [_jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"{\"\n          }), \" act \", _jsx(_components.span, {\n            className: \"token punctuation\",\n            children: \"}\"\n          })]\n        }), \" \", _jsx(_components.span, {\n          className: \"token keyword module\",\n          children: \"from\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token string\",\n          children: \"'react-dom/test-utils'\"\n        }), \"\\n\\n\", _jsx(_components.span, {\n          className: \"token comment\",\n          children: \"// a variable to hold reset functions for all stores declared in the app\"\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"token keyword\",\n          children: \"const\"\n        }), \" storeResetFns \", _jsx(_components.span, {\n          className: \"token operator\",\n          children: \"=\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token keyword\",\n          children: \"new\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token class-name\",\n          children: \"Set\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"(\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \")\"\n        }), \"\\n\\n\", _jsx(_components.span, {\n          className: \"token comment\",\n          children: \"// when creating a store, we get its initial state, create a reset function and add it in the set\"\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"token keyword\",\n          children: \"const\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token function-variable function\",\n          children: \"create\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token operator\",\n          children: \"=\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"(\"\n        }), _jsx(_components.span, {\n          className: \"token parameter\",\n          children: \"createState\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \")\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token arrow operator\",\n          children: \"=\u003e\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"{\"\n        }), \"\\n  \", _jsx(_components.span, {\n          className: \"token keyword\",\n          children: \"const\"\n        }), \" store \", _jsx(_components.span, {\n          className: \"token operator\",\n          children: \"=\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token function\",\n          children: \"actualCreate\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"(\"\n        }), \"createState\", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \")\"\n        }), \"\\n  \", _jsx(_components.span, {\n          className: \"token keyword\",\n          children: \"const\"\n        }), \" initialState \", _jsx(_components.span, {\n          className: \"token operator\",\n          children: \"=\"\n        }), \" store\", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \".\"\n        }), _jsx(_components.span, {\n          className: \"token method function property-access\",\n          children: \"getState\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"(\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \")\"\n        }), \"\\n  storeResetFns\", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \".\"\n        }), _jsx(_components.span, {\n          className: \"token method function property-access\",\n          children: \"add\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"(\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"(\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \")\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token arrow operator\",\n          children: \"=\u003e\"\n        }), \" store\", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \".\"\n        }), _jsx(_components.span, {\n          className: \"token method function property-access\",\n          children: \"setState\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"(\"\n        }), \"initialState\", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \",\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token boolean\",\n          children: \"true\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \")\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \")\"\n        }), \"\\n  \", _jsx(_components.span, {\n          className: \"token keyword control-flow\",\n          children: \"return\"\n        }), \" store\\n\", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"}\"\n        }), \"\\n\\n\", _jsx(_components.span, {\n          className: \"token comment\",\n          children: \"// Reset all stores after each test run\"\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"token function\",\n          children: \"afterEach\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"(\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"(\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \")\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token arrow operator\",\n          children: \"=\u003e\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"{\"\n        }), \"\\n  \", _jsx(_components.span, {\n          className: \"token function\",\n          children: \"act\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"(\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"(\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \")\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token arrow operator\",\n          children: \"=\u003e\"\n        }), \" storeResetFns\", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \".\"\n        }), _jsx(_components.span, {\n          className: \"token method function property-access\",\n          children: \"forEach\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"(\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"(\"\n        }), _jsx(_components.span, {\n          className: \"token parameter\",\n          children: \"resetFn\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \")\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token arrow operator\",\n          children: \"=\u003e\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token function\",\n          children: \"resetFn\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"(\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \")\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \")\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \")\"\n        }), \"\\n\", _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \"}\"\n        }), _jsx(_components.span, {\n          className: \"token punctuation\",\n          children: \")\"\n        }), \"\\n\\n\", _jsx(_components.span, {\n          className: \"token keyword module\",\n          children: \"export\"\n        }), \" \", _jsx(_components.span, {\n          className: \"token keyword module\",\n          children: \"default\"\n        }), \" create\\n\"]\n      })\n    }), \"\\n\", _jsx(_components.p, {\n      children: \"The way you can mock a dependency depends on your test runner.\"\n    }), \"\\n\", _jsxs(_components.p, {\n      children: [\"In \", _jsx(_components.a, {\n        href: \"https://jestjs.io/\",\n        children: \"jest\"\n      }), \", you can create a \", _jsx(_components.code, {\n        children: \"__mocks__/zustand.js\"\n      }), \" and place the code there. If your app is using \", _jsx(_components.code, {\n        children: \"zustand/vanilla\"\n      }), \" instead of \", _jsx(_components.code, {\n        children: \"zustand\"\n      }), \", then you'll have to place the above code in \", _jsx(_components.code, {\n        children: \"__mocks__/zustand/vanilla.js\"\n      })]\n    })]\n  });\n}\nfunction MDXContent(props = {}) {\n  const {wrapper: MDXLayout} = Object.assign({}, _provideComponents(), props.components);\n  return MDXLayout ? _jsx(MDXLayout, Object.assign({}, props, {\n    children: _jsx(_createMdxContent, props)\n  })) : _createMdxContent(props);\n}\nreturn {\n  default: MDXContent\n};\n","frontmatter":{},"scope":{}}},"__N_SSG":true},"page":"/[...slug]","query":{"slug":["r3f-notes","testing"]},"buildId":"p0U-IbqHePFZ_BQy1u2Ej","assetPrefix":"/docs","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>